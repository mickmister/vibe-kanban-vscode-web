services:
  code-vibe:
    build:
      context: .
      args:
        VIBE_KANBAN_VERSION: "latest"

    ports:
      - "${CADDY_PORT:-3001}:3001"         # caddy (main entry point)
      - "${VIBE_KANBAN_PORT:-3007}:3007"   # vibe-kanban (direct access)
      - "${VS_CODE_PORT:-3008}:3008"       # vscode (direct access)

    environment:
      VIBE_KANBAN_VERSION: ${VIBE_KANBAN_VERSION:-latest}
      CADDY_PORT: 3001
      BACKEND_PORT: 3007 # vibe-kanban
      PORT: 3008 # vscode

      PASSWORD: ${CODE_PASSWORD}
      SUDO_PASSWORD: ${SUDO_PASSWORD}

    volumes:
      # Persist git repositories
      # - ~/repos:/home/vkuser/repos
      - vibe-kanban-repos:/home/vkuser/repos
      # Persist vibe-kanban database and data
      - vibe-kanban-data:/home/vkuser/.local/share/ai.bloop.vibe-kanban
      # Persist worktrees
      - vibe-kanban-worktrees:/var/tmp/vibe-kanban/worktrees
      # Persist code-server settings (optional, but allows user customizations to persist)
      - code-server-data:/home/vkuser/.local/share/code-server
      # Persist Claude Code data
      - claude-data:/home/vkuser/.claude
      # Persist GitHub CLI authentication
      - gh-config:/home/vkuser/.config/gh

volumes:
  vibe-kanban-repos:
  vibe-kanban-data:
  vibe-kanban-worktrees:
  code-server-data:
  claude-data:
  gh-config:
